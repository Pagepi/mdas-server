spring.application.name=mdas-server

# 下面是需要追加的数据库配置
# 应用服务器端口
server.port=8080

# 数据库连接配置 - 指向您的Ubuntu虚拟机
# 数据库配置 - 使用环境变量
spring.datasource.url=jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:mdas}
spring.datasource.username=${DB_USERNAME:mdassa}
spring.datasource.password=${DB_PASSWORD:}

# JWT配置 - 使用环境变量
jwt.secret=${JWT_SECRET:mdas-dev-secret-change-in-production}
jwt.expiration=${JWT_EXPIRATION:604800000}
jwt.issuer=${JWT_ISSUER:mdas-server}

# Redis配置 - 使用环境变量
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.password=${REDIS_PASSWORD:}
spring.data.redis.database=${REDIS_DATABASE:0}
spring.data.redis.timeout=3000ms
spring.data.redis.connect-timeout=2000ms

# Redis连接池配置
spring.data.redis.lettuce.pool.max-active=8
spring.data.redis.lettuce.pool.max-wait=-1ms
spring.data.redis.lettuce.pool.max-idle=8
spring.data.redis.lettuce.pool.min-idle=0

# Redis序列化配置
spring.data.redis.serialization.type=json

# =============================================
# 速率限制配置 (Bucket4j)
# =============================================

# 启用Bucket4j
bucket4j.enabled=true

# 使用Redis作为后端
bucket4j.filters[0].filter-method=servlet
bucket4j.filters[0].url=.*
bucket4j.filters[0].strategy=first

# 登录接口限制：每分钟5次
bucket4j.filters[0].rate-limits[0].cache-name=buckets
bucket4j.filters[0].rate-limits[0].bandwidths[0].capacity=5
bucket4j.filters[0].rate-limits[0].bandwidths[0].time=1
bucket4j.filters[0].rate-limits[0].bandwidths[0].unit=minutes
bucket4j.filters[0].rate-limits[0].bandwidths[0].refill-speed=5
bucket4j.filters[0].rate-limits[0].bandwidths[0].refill-interval=1
bucket4j.filters[0].rate-limits[0].bandwidths[0].refill-unit=minutes

# API通用限制：每小时100次
bucket4j.filters[0].rate-limits[1].cache-name=buckets
bucket4j.filters[0].rate-limits[1].bandwidths[0].capacity=100
bucket4j.filters[0].rate-limits[1].bandwidths[0].time=1
bucket4j.filters[0].rate-limits[1].bandwidths[0].unit=hours

# Redis配置
bucket4j.filters[0].rate-limits[0].skip-condition=true

# JPA 和 Hibernate 配置
spring.jpa.database=POSTGRESQL
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.format_sql=true

# 禁用 Spring Security 自动配置
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration

# 登录配置
login.max-fail-count=5
login.lock-duration=1800

# 可选：在控制台输出彩色的SQL日志，更易读
logging.pattern.console=%clr(%d{HH:mm:ss.SSS}){faint} %clr(%-5level) %clr(%logger{36}){cyan} %clr(:){faint} %m%n